sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/m/TablePersoController","./DemoPersoService","GoodReceipt/Js/jspdf.min","GoodReceipt/Js/jspdf.plugin.autotable","GoodReceipt/Js/FileSaver","GoodReceipt/Js/jquery.cookie"],function(e,t,l,s,a,i,n,r,o){"use strict";var d,g,u,c;return e.extend("GoodReceipt.controller.GoodReceiptDetails",{onInit:function(){d=this;var e=sap.ui.core.Component.getOwnerIdFor(this.getView());d.oComponent=sap.ui.component(e);var t=d.oComponent.getComponentData().startupParameters;d.clnt=t["SYSALIAS "][0].split('"')[1];if(d.clnt===undefined){d.clnt=t["SYSALIAS "][0]}var l=e.indexOf("-display-");if(l>-1){u=true;d.getView().byId("goodPage").setTitle("Goods Receipt - Display")}else{u=false;d.getView().byId("goodPage").setTitle("Goods Receipt - Change")}if(d.clnt===undefined||d.clnt===""){d.sServiceUrl="/sap/opu/odata/sap/ZP2S_METALRECEIVING_SRV"}else{d.sServiceUrl="/sap/opu/odata/sap/ZP2S_METALRECEIVING_SRV;o="+d.clnt+"/"}this._setDefaultData();d.IPrinterPlants=["4211"];d.OLatchFordPlant=["4211"];this._TableSettiing();this._TableDetailSetting();this.getView().byId("inputRefId").attachBrowserEvent("keypress",function(e){if(e.which===13){d.onGoodReceipt()}});this.getView().byId("datePicker1").attachBrowserEvent("keypress",function(e){if(e.which===13){d.onGoodReceipt()}});this.getView().byId("inputPlant").attachBrowserEvent("keypress",function(e){if(e.which===13){d.onGoodReceipt()}});if(d.getOwnerComponent().getComponentData().startupParameters.RefId===undefined){d.flagNav=""}else{d.flagNav="X"}d.getView().byId("idGoodReceiptHeaderTable").onAfterRendering=function(){if(d.getOwnerComponent().getComponentData().startupParameters.RefId){d.onTableRowSelection()}};var s=true},getMyComponent:function(){var e=sap.ui.core.Component.getOwnerIdFor(this.getView());return sap.ui.component(e)},_setDescription:function(){var e=d.getView().byId("inputPlant").getValue();if(d.OLatchFordPlant.indexOf(e)!==-1){d.getView().byId("lblPw").setText("Anex7:")}else{d.getView().byId("lblPw").setText("Paper Work:")}var t=d.getView().byId("txtLoc");if(e===""){t.setText("")}else{var l=d.getView().getModel("oPlantModel");for(var s=0;s<l.getData().length;s++){if(l.getData()[s].Plant===e){t.setText(l.getData()[s].Name1)}}}},onPlantChange:function(){this._setDescription()},_setDefaultData:function(){var e=new sap.ui.model.odata.ODataModel(d.sServiceUrl);var s="/OnLoadSet('')?$expand=NavPlant";e.read(s,null,null,true,function(e){if(e){var l=new t;l.setData(e);d.getView().byId("mainForm").setModel(l,"goodModel");d.datePattern=e.EPattern;var s=new t;s.setData(e.NavPlant.results);d.getView().setModel(s,"oPlantModel");d._setDescription()}var a=e.EPattern.replace(/D/gi,"d");var i=new t;i.setData({dateValueDRS1:new Date,dateFormatDRS1:a});d.getView().byId("datePicker1").setModel(i);d._setCrossApp()},function(e){var t=$.parseXML(e.response.body);var s=t.querySelector("message");l.error(s.textContent)})},_setCrossApp:function(){if(d.getOwnerComponent().getComponentData().startupParameters.RefId){var e=d.getOwnerComponent().getComponentData().startupParameters.RefId[0];d.getView().byId("inputRefId").setValue(e);d.getView().byId("inputPlant").setValue("4211");d._setDescription();d.onGoodReceipt()}},onClose:function(){this._oTPC.destroy();this._oTPC1.destroy()},handleOpenDialog:function(e){var t=e.getSource().getTooltip();if(t==="Detail Settings"){this._oTPC1.openDialog()}else{this._oTPC.openDialog()}},_BindHeaderTable:function(){sap.ui.core.BusyIndicator.show();var e=this.getView().byId("idGoodReceiptHeaderTable");var s=d.getView().byId("inputRefId").getValue();var a=d.getView().byId("inputPlant").getValue();var i="/MROverviewSet?$filter=(IReferenceid eq '"+s+"' and IPlant eq '"+a+"'";var n,r;var o=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});if(!this.getView().byId("datePicker1").getSecondDateValue()&&this.getView().byId("datePicker1").getDateValue()){n=o.format(new Date(d.getView().byId("datePicker1").getDateValue()))+"T00:00:00";r=n;i+=" and IDatefrom eq datetime'"+n+"' and IDateto eq datetime'"+r+"'"}else if(this.getView().byId("datePicker1").getSecondDateValue()){n=o.format(new Date(d.getView().byId("datePicker1").getDateValue()))+"T00:00:00";r=o.format(new Date(d.getView().byId("datePicker1").getSecondDateValue()))+"T00:00:00";i+=" and IDatefrom eq datetime'"+n+"' and IDateto eq datetime'"+r+"'"}i+=")";var g=new sap.ui.model.odata.ODataModel(d.sServiceUrl);g.read(i,null,null,true,function(s){if(s.results.length!==0){d.getView().byId("sc1").setVisible(true);d.byId("pnlGoodsHeader").setExpanded(true);d.byId("sc2").setVisible(false);var a=new t;a.setData(s);d.getView().setModel(a,"headerModel");if(s.results[0].Sttrg==="1"){l.error("The Truck has not Checked-In, Goods receipt cannot be processed !")}else{var i="Incoming weight";var n="Outgoing weight";var r="Net weight";if(s.results[0].Uom){d.byId("txtInWt").setText("");d.byId("txtOutWt").setText("");d.byId("txtNetWt").setText("");d.byId("txtInWt").setText(i+"\n"+"("+s.results[0].Uom+")");d.byId("txtOutWt").setText(n+"\n"+"("+s.results[0].Uom+")");d.byId("txtNetWt").setText(r+"\n"+"("+s.results[0].Uom+")")}d._setHeaderTableTemplate(a)}}else{l.error("No Trucks for the Given selection !");d.byId("sc1").setVisible(false);d.byId("sc2").setVisible(false);e.unbindAggregation("items");e.unbindItems()}jQuery.sap.delayedCall(1500,d,function(){sap.ui.core.BusyIndicator.hide()})},function(e){var t=$.parseXML(e.response.body);var s=t.querySelector("message");l.error(s.textContent);jQuery.sap.delayedCall(1500,d,function(){sap.ui.core.BusyIndicator.hide()})})},_setHeaderTableTemplate:function(e){var t=this.getView().byId("idGoodReceiptHeaderTable");var l=new sap.m.ColumnListItem({type:"Inactive",cells:[new sap.m.Text({text:"{Referenceid}"}),new sap.m.Text({text:"{Inbounddelno}"}),new sap.m.Text({text:"{Shipmentno}"}),new sap.m.Text({text:"{Status}"}),new sap.m.Text({text:{parts:[{path:"Actualcidt"},{path:"Actualcitime"}],formatter:function(e,t){if(!t&&!e){return""}else{var l="";var s="";if(t){l=t.charAt(2)+t.charAt(3)+":"+t.charAt(5)+t.charAt(6)+":"+t.charAt(8)+t.charAt(9)}if(e){var a=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:d.datePattern.replace(/D/gi,"d")});s=a.format(new Date(e))}return s+"\n"+l}}}}),new sap.m.Text({text:"{Incomingwt}"}),new sap.m.Text({text:"{Outgoingwt}"}),new sap.m.Text({text:"{Netweight}"}),new sap.m.Text({text:"{Receivingpt}",textAlign:"Left"}),new sap.m.Text({text:"{Fwdagentname}",textAlign:"Left"}),new sap.m.Text({text:"{Carriername}"}),new sap.m.Text({text:"{Material}"}),new sap.m.Text({text:"{Trucknum}",textAlign:"Left"}),new sap.m.Text({text:"{Trailernum}",textAlign:"Left"})]}).addStyleClass("sapUiSizeCompact");t.setModel(e);t.bindAggregation("items",{path:"/results",template:l})},_getDefaultStorageLoc:function(){var e=new sap.ui.model.odata.ODataModel(d.sServiceUrl);d.plant=d.getView().byId("inputPlant").getValue();var t="/BinlocSet?$filter=IPlant eq '"+d.plant+"'";d.sLoc="";var l=d.getView().byId("idGoodReceiptTable");e.read(t,null,null,true,function(e){for(var t=0;t<l.getItems().length;t++){l.getItems()[t].getCells()[13].setValue(e.results[0].CLgort)}d.sLoc=e.results[0].CLgort});return d.sLoc},onSelectDetail:function(e){var t=e.getSource();if(g==="X"){d._setDetailDisplayModeOnSel(t)}else{d._setDetailEditModeOnSel(t)}},_setDetailDisplayModeOnSel:function(e){d.byId("inputDW").setEditable(false);d.byId("rbYes").setEnabled(false);d.byId("rbNo").setEnabled(false);var t;for(var l=0;l<e.getItems().length;l++){e.getItems()[l].getCells()[3].setEditable(false);e.getItems()[l].getCells()[4].setEditable(false);e.getItems()[l].getCells()[7].setShowValueHelp(false);e.getItems()[l].getCells()[7].setEditable(false);e.getItems()[l].getCells()[8].setEnabled(false);e.getItems()[l].getCells()[12].setEditable(false);e.getItems()[l].getCells()[12].setShowValueHelp(false);t=e.getItems()[l].getSelected();if(t===false){e.getItems()[l].getCells()[3].removeStyleClass("hideSelectedInputBorder");e.getItems()[l].getCells()[3].addStyleClass("hideInputBorder");e.getItems()[l].getCells()[12].removeStyleClass("hideSelectedInputBorder");e.getItems()[l].getCells()[12].addStyleClass("hideInputBorder");e.getItems()[l].getCells()[7].removeStyleClass("hideSelectedInputBorder");e.getItems()[l].getCells()[7].addStyleClass("hideInputBorder");e.getItems()[l].getCells()[4].removeStyleClass("hideSelectedInputBorder");e.getItems()[l].getCells()[4].addStyleClass("hideInputBorder");e.getItems()[l].getCells()[8].removeStyleClass("hideSelectedInputBorder");e.getItems()[l].getCells()[8].addStyleClass("hideInputBorder")}else{e.getItems()[l].getCells()[3].removeStyleClass("hideInputBorder");e.getItems()[l].getCells()[3].addStyleClass("hideSelectedInputBorder");e.getItems()[l].getCells()[12].removeStyleClass("hideInputBorder");e.getItems()[l].getCells()[12].addStyleClass("hideSelectedInputBorder");e.getItems()[l].getCells()[7].removeStyleClass("hideInputBorder");e.getItems()[l].getCells()[7].addStyleClass("hideSelectedInputBorder");e.getItems()[l].getCells()[4].removeStyleClass("hideInputBorder");e.getItems()[l].getCells()[4].addStyleClass("hideSelectedInputBorder");e.getItems()[l].getCells()[8].removeStyleClass("hideInputBorder");e.getItems()[l].getCells()[8].addStyleClass("hideSelectedInputBorder")}}},_setDetailEditModeOnSel:function(e){d.byId("inputDW").setEditable(true);d.byId("rbYes").setEnabled(true);d.byId("rbNo").setEnabled(true);var t;for(var l=0;l<e.getItems().length;l++){e.getItems()[l].getCells()[4].setEditable(true);e.getItems()[l].getCells()[7].setEditable(true);e.getItems()[l].getCells()[7].setShowValueHelp(true);e.getItems()[l].getCells()[8].setEnabled(true);e.getItems()[l].getCells()[12].setShowValueHelp(true);e.getItems()[l].getCells()[12].setEditable(true);t=e.getItems()[l].getSelected();if(t===false){e.getItems()[l].getCells()[3].removeStyleClass("hideInputBorder");e.getItems()[l].getCells()[12].removeStyleClass("hideInputBorder");e.getItems()[l].getCells()[7].removeStyleClass("hideInputBorder");e.getItems()[l].getCells()[8].removeStyleClass("hideInputBorder");e.getItems()[l].getCells()[4].removeStyleClass("hideInputBorder")}else{e.getItems()[l].getCells()[3].removeStyleClass("hideSelectedInputBorder");e.getItems()[l].getCells()[12].removeStyleClass("hideSelectedInputBorder");e.getItems()[l].getCells()[7].removeStyleClass("hideSelectedInputBorder");e.getItems()[l].getCells()[8].removeStyleClass("hideSelectedInputBorder");e.getItems()[l].getCells()[4].removeStyleClass("hideSelectedInputBorder")}}},_BindDetailtable:function(e){var s=this.getView().byId("idGoodReceiptTable");d.plant=d.getView().byId("inputPlant").getValue();var a=new sap.ui.model.odata.ODataModel(d.sServiceUrl);var i=this.getView().byId("idGoodReceiptHeaderTable");var n=i.getSelectedItem().getCells()[0].getText();var r=i.getSelectedItem().getCells()[1].getText();var o=i.getSelectedItem().getCells()[2].getText();if(d.flagNav==="X"){var c="X"}else{c=""}var m="/MRDetailSet(IDelivery='"+r+"',IReferenceid='"+n+"',INavigation='"+c+"',IShipment='"+o+"')?$expand=NavMRDetail";d.oBusy=new sap.m.BusyDialog;d.oBusy.open();var p;a.read(m,null,null,true,function(e){if(e){var l=new t;l.setData(e);d.getView().setModel(l,"detailModel");g=e.EDisplay;p=e.Paperwork;d.GoodssupplierCode=e.Goodssupplier;d.byId("textRefId").setText(e.IReferenceid);d.byId("txtIndelivery").setText(e.Inbounddelno);d.byId("txtShip").setText(e.IShipment);d.byId("textCarrier").setText(e.Carrier);d.byId("txtGs").setText(e.Goodssuppliername);d.byId("txtPlant").setText(e.Recvpt);var a=new sap.ui.core.CustomData({key:e.Plant,value:e.Plant});d.byId("txtPlant").addCustomData(a);d.byId("txtTdate").setText(d.dateTime(e.Receiptdt));d.recptdt=e.Receiptdt;d.byId("inputIW").setText(e.Incomingwt);d.byId("inputOW").setText(e.Outgoingwt);d.byId("inputDW").setValue(e.Dunnagewt);d.byId("inputNW").setText(e.Netweight);if(e.Zuom){d.byId("lblOutWeight").setText("Outgoing Weight"+"("+e.Zuom+"):");d.byId("lblNetWeight").setText("Net Weight"+"("+e.Zuom+"):");d.byId("lblInWeight").setText("Incoming Weight"+"("+e.Zuom+"):");d.byId("lblDunnWeight").setText("Dunnage Weight"+"("+e.Zuom+"):")}d.uom=e.Zuom;var i="Skid Weight";var n="Band Weight";var r="Ship Weight";if(d.uom){d.byId("txtSkidWt").setText("");d.byId("txtBandWt").setText("");d.byId("txtShipWt").setText("");d.byId("txtSkidWt").setText(i+"\n"+"("+e.Zuom+")");d.byId("txtBandWt").setText(n+"\n"+"("+e.Zuom+")");d.byId("txtShipWt").setText(r+"\n"+"("+e.Zuom+")")}if(u){d._setDetailDisplayTableTemplate(l);s.setMode("None");d._setFooterDisable();d.getView().byId("rbYes").setEditable(false);d.getView().byId("rbNo").setEditable(false);d.byId("inputDW").setEditable(false)}else{d._setDetailTableTemplate(l);s.setMode("MultiSelect");d._setFooterEnable();if(g==="X"){d._setDetailDisplayModeOnInit(e)}else{d.setDetailEditModeOnInit(p,e)}if(p==="X"){d.getView().byId("rbYes").setEditable(false);d.getView().byId("rbNo").setEditable(false)}else{d.getView().byId("rbYes").setEditable(true);d.getView().byId("rbNo").setEditable(true)}}if(p==="Y"){d.byId("rbYes").setSelected(true)}else if(p==="N"){d.byId("rbNo").setSelected(true)}else{d.byId("rbYes").setSelected(true);d.byId("rbNo").setSelected(false)}for(var o=0;o<s.getItems().length;o++){s.getItems()[o].getCells()[14].setSelectedIndex(0);if(e.NavMRDetail.results[o].Mixstock==="Y"){s.getItems()[o].getCells()[9].setSelectedIndex(0)}else{s.getItems()[o].getCells()[9].setSelectedIndex(1)}if(e.NavMRDetail.results[o].Moisturef==="Y"){s.getItems()[o].getCells()[14].setSelectedIndex(0)}if(e.NavMRDetail.results[o].Moisturef==="N"){s.getItems()[o].getCells()[14].setSelectedIndex(1)}if(u){if(e.NavMRDetail.results[o].Quality==="Y"){s.getItems()[o].getCells()[1].getItems()[0].getButtons()[0].setSelected(true);s.getItems()[o].getCells()[1].getItems()[0].getButtons()[1].setSelected(false)}else if(e.NavMRDetail.results[o].Quality==="N"){s.getItems()[o].getCells()[1].getItems()[0].getButtons()[0].setSelected(false);s.getItems()[o].getCells()[1].getItems()[0].getButtons()[1].setSelected(true)}else{s.getItems()[o].getCells()[1].getItems()[0].getButtons()[0].setSelected(false);s.getItems()[o].getCells()[1].getItems()[0].getButtons()[1].setSelected(false)}}}jQuery.sap.delayedCall(1500,d,function(){d.oBusy.close()})}else{d._setFooterDisable();jQuery.sap.delayedCall(1500,d,function(){d.oBusy.close()})}},function(e){d._setFooterDisable();var t=$.parseXML(e.response.body);var s=t.querySelector("message");l.error(s.textContent);jQuery.sap.delayedCall(1500,d,function(){d.oBusy.close()})})},_setDetailDisplayModeOnInit:function(e){var t=this.getView().byId("idGoodReceiptTable");d.byId("inputDW").setEditable(false);d.byId("rbYes").setEnabled(false);d.byId("rbNo").setEnabled(false);for(var l=0;l<t.getItems().length;l++){if(e.NavMRDetail["results"][l].Itemflag==="X"){t.getItems()[l].setSelected(true)}else{t.getItems()[l].setSelected(false)}var s=t.getItems()[l].getCells()[7];s.getItems()[1].setVisible(true);s.getItems()[0].setVisible(false);if(e.NavMRDetail.results[l].Quality==="Y"){t.getItems()[l].getCells()[1].getItems()[0].getButtons()[0].setSelected(true);t.getItems()[l].getCells()[1].getItems()[0].getButtons()[0].setEditable(true)}else if(e.NavMRDetail.results[l].Quality==="N"){t.getItems()[l].getCells()[1].getItems()[0].getButtons()[1].setSelected(true);t.getItems()[l].getCells()[1].getItems()[0].getButtons()[1].setEditable(true);t.getItems()[l].getCells()[1].getItems()[0].getButtons()[0].setEditable(true)}else{t.getItems()[l].getCells()[1].getItems()[0].getButtons()[0].setEditable(true);t.getItems()[l].getCells()[1].getItems()[0].getButtons()[1].setEditable(true);t.getItems()[l].getCells()[1].getItems()[0].setSelectedIndex(-1)}t.getItems()[l].getCells()[4].setEditable(false);t.getItems()[l].getCells()[8].setEditable(false);t.getItems()[l].getCells()[8].setShowValueHelp(false);t.getItems()[l].getCells()[5].setEditable(false);t.getItems()[l].getCells()[5].setShowValueHelp(false);t.getItems()[l].getCells()[9].setEnabled(false);t.getItems()[l].getCells()[13].setEditable(false);t.getItems()[l].getCells()[13].setShowValueHelp(false);var a=t.getItems()[l].getSelected();if(a===false){t.getItems()[l].getCells()[4].addStyleClass("hideInputBorder");t.getItems()[l].getCells()[13].addStyleClass("hideInputBorder");t.getItems()[l].getCells()[8].addStyleClass("hideInputBorder");t.getItems()[l].getCells()[9].addStyleClass("hideInputBorder");t.getItems()[l].getCells()[5].addStyleClass("hideInputBorder")}else{t.getItems()[l].getCells()[4].addStyleClass("hideSelectedInputBorder");t.getItems()[l].getCells()[13].addStyleClass("hideSelectedInputBorder");t.getItems()[l].getCells()[10].addStyleClass("hideSelectedInputBorder");t.getItems()[l].getCells()[7].addStyleClass("hideSelectedInputBorder");t.getItems()[l].getCells()[11].addStyleClass("hideSelectedInputBorder")}}},setDetailEditModeOnInit:function(e,t){var l=this.getView().byId("idGoodReceiptTable");d.byId("inputDW").setEditable(true);d.byId("rbYes").setEnabled(true);d.byId("rbNo").setEnabled(true);if(e==="Y"||e==="N"){d.getView().byId("rbYes").setEditable(false)}else{d.getView().byId("rbYes").setEditable(true)}for(var s=0;s<l.getItems().length;s++){if(t.NavMRDetail["results"][s].Itemflag==="X"){l.getItems()[s].setSelected(true)}else{l.getItems()[s].setSelected(false)}l.getItems()[s].getCells()[7].getItems()[0].setVisible(true);l.getItems()[s].getCells()[7].getItems()[1].setVisible(false);l.getItems()[s].getCells()[13].setEditable(true);l.getItems()[s].getCells()[8].setEditable(true);l.getItems()[s].getCells()[5].setEditable(true);l.getItems()[s].getCells()[9].setEnabled(true);l.getItems()[s].getCells()[8].setShowValueHelp(true);l.getItems()[s].getCells()[13].setShowValueHelp(true);var a=l.getItems()[s].getSelected();if(a===false){l.getItems()[s].getCells()[4].removeStyleClass("hideInputBorder");l.getItems()[s].getCells()[5].removeStyleClass("hideInputBorder");l.getItems()[s].getCells()[8].removeStyleClass("hideInputBorder");l.getItems()[s].getCells()[9].removeStyleClass("hideInputBorder");l.getItems()[s].getCells()[13].removeStyleClass("hideInputBorder")}else{l.getItems()[s].getCells()[4].removeStyleClass("hideSelectedInputBorder");l.getItems()[s].getCells()[5].removeStyleClass("hideSelectedInputBorder");l.getItems()[s].getCells()[8].removeStyleClass("hideSelectedInputBorder");l.getItems()[s].getCells()[9].removeStyleClass("hideSelectedInputBorder");l.getItems()[s].getCells()[13].removeStyleClass("hideSelectedInputBorder")}if(t.NavMRDetail.results[s].Quality==="Y"){l.getItems()[s].getCells()[1].getItems()[0].getButtons()[0].setSelected(true);l.getItems()[s].getCells()[1].getItems()[0].getButtons()[0].setEditable(true)}else if(t.NavMRDetail.results[s].Quality==="N"){l.getItems()[s].getCells()[1].getItems()[0].getButtons()[1].setSelected(true);l.getItems()[s].getCells()[1].getItems()[0].getButtons()[1].setEditable(true);l.getItems()[s].getCells()[1].getItems()[0].getButtons()[0].setEditable(true)}else{l.getItems()[s].getCells()[1].getItems()[0].getButtons()[0].setEditable(true);l.getItems()[s].getCells()[1].getItems()[0].getButtons()[1].setEditable(true);l.getItems()[s].getCells()[1].getItems()[0].setSelectedIndex(-1)}}},_setDetailTableTemplate:function(e){var t=this.getView().byId("idGoodReceiptTable");var l=new sap.m.ColumnListItem({type:"Inactive",cells:[new sap.m.Text({text:"{Description}"}),new sap.m.HBox({width:"100%",justifyContent:"Center",alignItems:"Center",items:[new sap.m.RadioButtonGroup({columns:5,buttons:[new sap.m.RadioButton({text:"Y",value:""}),new sap.m.RadioButton({text:"N",value:""})]})]}),new sap.m.CheckBox({selected:{parts:[{path:"Fullrej"}],formatter:function(e){if(e==="Y"){return true}else if(e==="N"){return false}else{return false}}},select:this.onFullrejCheckSelect}),new sap.m.Text({text:"{Batch}"}),new sap.m.Input({value:{parts:[{path:"Quantity"}],formatter:function(e){if(e==="000000"){return""}else{return e}}},type:"Number",change:function(e){var t=e.getParameter("value");var l=e.getSource().getParent().getCells()[11].getText();var s=d.getView().byId("inputPlant").getValue();var a=e.getSource().getParent().getCells()[10].getText();var i=d.getView().byId("txtIndelivery").getText();var n=new sap.ui.model.odata.ODataModel(d.sServiceUrl);d.oBusy=new sap.m.BusyDialog;d.oBusy.open();d.itemPressed=e.getSource().getParent();var r="/DetailweightsSet(IMaterial='"+l+"',IPlant='"+s+"',IQuantity='"+t+"',IVbeln='"+i+"',IPosnr='"+a+"')";n.read(r,null,null,true,function(e){jQuery.sap.delayedCall(2e3,d,function(){d.oBusy.close()});if(e){d.itemPressed.getCells()[5].setValue(e.ESkidwt);d.itemPressed.getCells()[6].setText(e.EBandingwt)}})}}),new sap.m.Input({value:"{Skidwt}",type:"Number"}),new sap.m.Text({text:"{Bandwt}"}),new sap.m.HBox({width:"100%",justifyContent:"Center",alignItems:"Center",items:[new sap.m.Input({value:"{Shipwt}",type:"Number"}),new sap.m.Text({text:"{Shipwt}"})]}),new sap.m.Input({value:"{Storagebin}",showValueHelp:true,valueHelpRequest:d._handleStorageLoc,customData:[new sap.ui.core.CustomData({key:"Bin"})]}),new sap.m.Select({items:[new sap.ui.core.Item({key:"Y",text:"Y"}),new sap.ui.core.Item({key:"N",text:"N"})]}),new sap.m.Text({text:"{Item}"}),new sap.m.Text({text:"{Material}"}),new sap.m.Text({text:{parts:[{path:"Inventorywt"}],formatter:function(e){if(d.uom===undefined||d.uom===""){return e}else{return e+"("+d.uom+")"}}}}),new sap.m.Input({value:{parts:[{path:"Storageloc"},{path:d.sLoc}],formatter:function(e,t){if(e===undefined||e===""){return t}else{return e}}},showValueHelp:true,valueHelpRequest:d._handleStorageLoc,customData:[new sap.ui.core.CustomData({key:"Loc"})]}),new sap.m.Select({items:[new sap.ui.core.Item({key:"Y",text:"Y"}),new sap.ui.core.Item({key:"N",text:"N"})]})]}).addStyleClass("sapUiSizeCompact");t.setModel(e);t.bindAggregation("items",{path:"/NavMRDetail/results",template:l})},_setDetailDisplayTableTemplate:function(e){var t=this.getView().byId("idGoodReceiptTable");var l=new sap.m.ColumnListItem({type:"Inactive",cells:[new sap.m.Text({text:"{Description}"}),new sap.m.HBox({width:"100%",justifyContent:"Center",alignItems:"Center",items:[new sap.m.RadioButtonGroup({columns:5,buttons:[new sap.m.RadioButton({enabled:false,text:"Y",value:""}),new sap.m.RadioButton({enabled:false,text:"N",value:""})]})]}),new sap.m.CheckBox({enabled:false,selected:{parts:[{path:"Fullrej"}],formatter:function(e){if(e==="Y"){return true}else if(e==="N"){return false}else{return false}}},select:this.onFullrejCheckSelect}),new sap.m.Text({text:"{Batch}"}),new sap.m.Text({text:{parts:[{path:"Quantity"}],formatter:function(e){if(e==="000000"){return""}else{return e}}}}),new sap.m.Text({text:"{Skidwt}"}),new sap.m.Text({text:"{Bandwt}"}),new sap.m.Text({text:"{Shipwt}"}),new sap.m.Text({text:"{Storagebin}"}),new sap.m.Select({enabled:false,items:[new sap.ui.core.Item({key:"Y",text:"Y"}),new sap.ui.core.Item({key:"N",text:"N"})]}),new sap.m.Text({text:"{Item}"}),new sap.m.Text({text:"{Material}"}),new sap.m.Text({text:{parts:[{path:"Inventorywt"}],formatter:function(e){if(d.uom===undefined||d.uom===""){return e}else{return e+"("+d.uom+")"}}}}),new sap.m.Text({text:{parts:[{path:"Storageloc"},{path:d.sLoc}],formatter:function(e,t){if(e===undefined||e===""){return t}else{return e}}}}),new sap.m.Select({enabled:false,items:[new sap.ui.core.Item({key:"Y",text:"Y"}),new sap.ui.core.Item({key:"N",text:"N"})]})]}).addStyleClass("sapUiSizeCompact");t.setModel(e);t.bindAggregation("items",{path:"/NavMRDetail/results",template:l})},_weightUnit:function(e,t){if(t===undefined||t===""){if(e===""||e==="0.000"){return""}else{return e}}else{if(e===""||e==="0.000"){return""}else{return e+"("+t+")"}}},handlesuggestSelect:function(e){d.getView().byId("txtLoc").setText(e.getParameter("selectedItem").getKey())},handleSuggest:function(e){var t=e.getParameter("suggestValue");var l=[];if(t){l.push(new sap.ui.model.Filter("Plant",sap.ui.model.FilterOperator.StartsWith,t))}e.getSource().getBinding("suggestionItems").filter(l)},_handleStorageLoc:function(e){var t=d.getView().byId("inputPlant").getValue();d.sid=e.getSource();d.valueHelpDialogLoc=new sap.m.SelectDialog({title:"Storage Location/Bin",contentWidth:"250px",growingThreshold:1500,search:[d._handleValueHelpSearchsLoc,d],confirm:[d._handleValueHelpClosesLoc,d],cancel:[d._handleValueHelpClosesLoc,d]});sap.ui.core.BusyIndicator.show();var l=new sap.ui.model.odata.ODataModel(d.sServiceUrl);var s="/BinlocSet?$filter=IPlant eq '"+t+"'";var a;d.cust=d.sid.getAggregation("customData");var i;if(d.cust[0].getProperty("key")==="Loc"){i=new sap.m.StandardListItem({title:"{BinLoc}",description:"{StorLoc}",customData:[new sap.ui.core.CustomData({key:"{BinLoc}"})]})}else{i=new sap.m.StandardListItem({title:"{StorLoc}",description:"{BinLoc}",customData:[new sap.ui.core.CustomData({key:"{StorLoc}"})]})}l.read(s,null,null,true,function(e){if(e){a=e;var t=new sap.ui.model.json.JSONModel(a);t.setSizeLimit(a.results.length);d.valueHelpDialogLoc.setModel(t);d.valueHelpDialogLoc.bindAggregation("items","/results",i);jQuery.sap.delayedCall(1500,d,function(){sap.ui.core.BusyIndicator.hide()});d.valueHelpDialogLoc.open()}})},_handleValueHelpSearchsLoc:function(e){var t=e.getParameter("value");t=t.toLowerCase();for(var l=0;l<d.valueHelpDialogLoc.getItems().length;l++){var s=d.valueHelpDialogLoc.getItems()[l].getTitle();s=s.toLowerCase();var a=d.valueHelpDialogLoc.getItems()[l].getDescription();a=a.toLowerCase();if(s.indexOf(t)>-1||a.indexOf(t)>-1){d.valueHelpDialogLoc.getItems()[l].setVisible(true)}else{d.valueHelpDialogLoc.getItems()[l].setVisible(false)}}},_handleValueHelpClosesLoc:function(e){var t=e.getParameter("selectedItem");if(t){d.sid.setValue(t.getDescription());if(d.cust[0].getKey()==="Loc"){d.sid.getParent().getCells()[8].setValue(t.getCustomData()[0].getProperty("key"))}else{d.sid.getParent().getCells()[13].setValue(t.getCustomData()[0].getProperty("key"))}}e.getSource().getBinding("items").filter([])},_handleValueHelpPlant:function(e){d.valueHelpDialogPlant=new sap.m.SelectDialog({title:"Plant",contentWidth:"250px",growingThreshold:1500,search:[d._handleValueHelpSearchPlant,d],confirm:[d._handleValueHelpClosePlant,d],cancel:[d._handleValueHelpClosePlant,d]});var t=new sap.m.StandardListItem({title:"{Plant}",description:"{Name1}",customData:[new sap.ui.core.CustomData({key:"{Plant}"})]});d.valueHelpDialogPlant.setModel(d.getView().getModel("oPlantModel"));d.valueHelpDialogPlant.bindAggregation("items","/",t);d.valueHelpDialogPlant.open()},_handleValueHelpSearchPlant:function(e){var t=e.getParameter("value");t=t.toLowerCase();for(var l=0;l<d.valueHelpDialogPlant.getItems().length;l++){var s=d.valueHelpDialogPlant.getItems()[l].getTitle();s=s.toLowerCase();var a=d.valueHelpDialogPlant.getItems()[l].getDescription();a=a.toLowerCase();if(s.indexOf(t)>-1||a.indexOf(t)>-1){d.valueHelpDialogPlant.getItems()[l].setVisible(true)}else{d.valueHelpDialogPlant.getItems()[l].setVisible(false)}}},_handleValueHelpClosePlant:function(e){var t=e.getParameter("selectedItem");if(t){d.getView().byId("inputPlant").setValue(t.getTitle())}e.getSource().getBinding("items").filter([])},onGoodReceipt:function(){var e=d.getView().byId("inputRefId").getValue();var t=d.getView().byId("inputPlant").getValue();var s=d.getView().byId("datePicker1").getDateValue();if((s===""||s===null)&&e===""){l.error("Please enter refrence id or DateRange !")}else if(t===""){l.error("Please enter plant !")}else{d._BindHeaderTable()}},onClearList:function(){d.getView().byId("inputRefId").setValue("");d.getView().byId("sc1").setVisible(false);d.getView().byId("sc2").setVisible(false);d._setFooterDisable();this.getView().byId("idGoodReceiptHeaderTable").unbindAggregation("items");this.getView().byId("idGoodReceiptHeaderTable").unbindItems();d.getView().byId("printBtn").setVisible(false)},onTableRowSelection:function(e){if(e){c=e.getSource().getSelectedContexts()[0].sPath.split("/")[2]}else{var t=d.getView().byId("idGoodReceiptHeaderTable").getItems();t[0].setSelected(true);c="0";if(d.flagNav==="X"){d._setDetailTabColumn()}}d.byId("pnlGoodsHeader").setExpanded(false);d.getView().byId("sc2").setVisible(true);d._getDefaultStorageLoc();d._BindDetailtable();d.addStyles();d.getView().byId("printBtn").setVisible(true)},_setDetailTabColumn:function(){d.getView().byId("ColEId_1").setVisible(false);d.getView().byId("ColSCAC_5").setVisible(false);d.getView().byId("ColType_7").setVisible(false);d.getView().byId("ColTrailer_10").setVisible(false);d.getView().byId("ColDelivery_12").setVisible(false);d.getView().byId("Col_13").setVisible(false)},addStyles:function(){d.getView().byId("lblRDate").addStyleClass("boldLabel");d.getView().byId("lblInDel").addStyleClass("boldLabel");d.getView().byId("lblShip").addStyleClass("boldLabel");d.getView().byId("lblGs").addStyleClass("boldLabel");d.getView().byId("lblPlant").addStyleClass("boldLabel");d.getView().byId("lblCarrier").addStyleClass("boldLabel");d.getView().byId("lblInWeight").addStyleClass("boldLabel");d.getView().byId("lblPw").addStyleClass("boldLabel");d.getView().byId("lblOutWeight").addStyleClass("boldLabel");d.getView().byId("lblDunnWeight").addStyleClass("boldLabel");d.getView().byId("lblNetWeight").addStyleClass("boldLabel");d.getView().byId("lblRefId1").addStyleClass("boldLabel")},onChangeDW:function(e){d.dunnage=d.getView().byId("inputDW");d.outWeight=d.getView().byId("inputOW");d.oBusy1=new sap.m.BusyDialog;d.oBusy1.open();if(d.getView().byId("inputIW").getText().indexOf("(")>-1){d.net=d.getView().byId("inputIW").getText().split("(")[0];d.um="("+d.getView().byId("inputIW").getText().split("(")[1].split(")")[0]+")"}else{d.net=d.getView().byId("inputIW").getText();d.um=""}if(d.outWeight.getText().indexOf("(")>-1){d.out=d.outWeight.getText().split("(")[0];d.um="("+d.outWeight.getText().split("(")[1].split(")")[0]+")"}else{d.out=d.outWeight.getText();d.um=""}if(e.getParameter("value").indexOf("(")>-1){d.dw=e.getParameter("value").split("(")[0]}else{d.dw=e.getParameter("value")}d.getView().byId("inputNW").setText(d.net-d.out-d.dw+d.um);jQuery.sap.delayedCall(1e3,d,function(){d.oBusy1.close()})},onSave:function(e){var t=d.getView().byId("rbYes").getSelected();var s=d.getView().byId("rbNo").getSelected();var a={};var i=[];var n=d.getView().byId("idGoodReceiptTable");var r=0;var o=0;var g=false;for(var u=0;u<n.getSelectedItems().length;u++){var c=n.getSelectedItems()[u].getCells()[2].getSelected();var m=n.getSelectedItems()[u].getCells()[1].getItems()[0].getButtons()[1].getSelected();if(c){r++}if(m){o++}}if(r>0&&r<n.getSelectedItems().length){l.error("Please select Full Reject checkbox for all items to proceed\nor un-check");g=false;return}else if(r>0&&r==n.getSelectedItems().length){g=true;if(o>0){d.InfoMsg="X"}d.updateGoods(a,i,s,n);return}if(s===false&&t===false){l.error("Please select the paperwork !");return}if(s===true){var p=d.getView().byId("inputPlant").getValue();if(d.OLatchFordPlant.indexOf(p)===-1){var I=!!this.getView().$().closest(".sapUiSizeCompact").length;l.show("Continue without paperwork ?",{icon:l.Icon.WARNING,title:"Warning",actions:[l.Action.YES,l.Action.NO],styleClass:I?"sapUiSizeCompact":"",onClose:function(e){if(e==="YES"){d.checkValidation(n);if(d.flagU===""){d.updateGoods(a,i,s,n)}}else{return}}})}else{d.saveData()}}else{d.saveData()}},onFullrejCheckSelect:function(e){var t=d.getView().byId("idGoodReceiptTable").getItems();if(e.getParameter("selected")){t.map(function(e){var t=e.getBindingContextPath();d.getView().byId("idGoodReceiptTable").getModel().setProperty(t+"/Fullrej","Y");e.getCells()[1].getItems()[0].getButtons()[0].setSelected(false);e.getCells()[1].getItems()[0].getButtons()[1].setSelected(true)})}else{t.map(function(e){var t=e.getBindingContextPath();d.getView().byId("idGoodReceiptTable").getModel().setProperty(t+"/Fullrej","N");e.getCells()[1].getItems()[0].getButtons()[0].setSelected(true);e.getCells()[1].getItems()[0].getButtons()[1].setSelected(false)})}},saveData:function(){var e=d.getView().byId("rbYes").getSelected();var t=d.getView().byId("rbNo").getSelected();var s={};var a=[];var i=d.getView().byId("idGoodReceiptTable");var n=!!this.getView().$().closest(".sapUiSizeCompact").length;d.checkValidation(i);if(d.flagU==="X"){if(d.SelectedFlag==="X"){var r=!!this.getView().$().closest(".sapUiSizeCompact").length;l.show("Not all items are selected – Do you still want to save selected items?",{icon:l.Icon.WARNING,title:"Warning",actions:[l.Action.OK,l.Action.CANCEL],styleClass:r?"sapUiSizeCompact":"",onClose:function(e){if(e==="OK"){d.flagU="";d.updateGoods(s,a,t,i)}else{d.flagU="X"}}})}}if(d.flagU===""&&d.warnQty==="X"){l.show("Number of pieces is blank- Are you sure you want to save?",{icon:l.Icon.WARNING,title:"Warning",actions:[l.Action.YES,l.Action.NO],styleClass:n?"sapUiSizeCompact":"",onClose:function(e){if(e==="YES"){d.checkValidation(i);if(d.flagU===""&&d.warnSkid===""){d.updateGoods(s,a,t,i)}else{l.show("Skid weight is blank- Are you sure you want to save?",{icon:l.Icon.WARNING,title:"Warning",actions:[l.Action.YES,l.Action.NO],styleClass:n?"sapUiSizeCompact":"",onClose:function(e){if(e==="YES"){d.checkValidation(i);if(d.flagU===""){d.updateGoods(s,a,t,i)}}else{return}}})}}else{return}}})}if(d.flagU===""&&d.warnQty===""){if(d.warnSkid==="X"){l.show("Skid weight is blank- Are you sure you want to save?",{icon:l.Icon.WARNING,title:"Warning",actions:[l.Action.YES,l.Action.NO],styleClass:n?"sapUiSizeCompact":"",onClose:function(e){if(e==="YES"){d.checkValidation(i);if(d.flagU===""){d.updateGoods(s,a,t,i)}}else{return}}})}}if(d.flagU===""&&d.warnQty===""&&d.warnSkid===""){d.updateGoods(s,a,t,i)}},checkValidation:function(e){if(d.getView().byId("inputNW").getText().indexOf("-")>-1){l.error("Net weight is in negative, please check the Incoming/outgoing weights !");d.flagU="X";return}for(var t=0;t<e.getSelectedItems().length;t++){if(e.getSelectedItems()[t].getCells()[1].getItems()[0].getButtons()[0].getSelected()===false&&e.getSelectedItems()[t].getCells()[1].getItems()[0].getButtons()[1].getSelected()===false){l.error("Please choose quality Y/N !");d.flagU="X";return}if(e.getSelectedItems()[t].getCells()[13].getProperty("value")===""){if(d.getOwnerComponent().getComponentData().startupParameters.RefId===undefined){e.getSelectedItems()[t].getCells()[13].setValueState(sap.ui.core.ValueState.Error);l.error("Please enter storage location and storage bin !");d.flagU="X";return}else{e.getSelectedItems()[t].getCells()[13].setValueState(sap.ui.core.ValueState.None);d.flagU=""}}else{e.getSelectedItems()[t].getCells()[13].setValueState(sap.ui.core.ValueState.None);d.flagU=""}if(e.getSelectedItems()[t].getCells()[8].getProperty("value")===""){if(d.getOwnerComponent().getComponentData().startupParameters.RefId===undefined){e.getSelectedItems()[t].getCells()[8].setValueState(sap.ui.core.ValueState.Error);l.error("Please enter storage location and storage bin !");d.flagU="X";return}else{e.getSelectedItems()[t].getCells()[8].setValueState(sap.ui.core.ValueState.None);d.flagU=""}}else{e.getSelectedItems()[t].getCells()[8].setValueState(sap.ui.core.ValueState.None);d.flagU=""}if(e.getSelectedItems()[t].getCells()[1].getItems()[0].getButtons()[1].getSelected()===true){d.InfoMsg="X"}else{d.InfoMsg=""}if(e.getSelectedItems()[t].getCells()[4].getValue()===""){d.flagU="";d.warnQty="X"}else{d.flagU="";d.warnQty=""}if(e.getSelectedItems()[t].getCells()[5].getValue()===""){d.flagU="";d.warnSkid="X"}else{d.flagU="";d.warnSkid=""}}if(e.getItems().length===e.getSelectedItems().length){d.flagU="";d.SelectedFlag=""}else{d.flagU="X";d.SelectedFlag="X";return}},_getItemsData:function(e,t){var l,s,a,i,n;for(var r=0;r<t.getSelectedItems().length;r++){if(t.getSelectedItems()[r].getCells()[1].getItems()[0].getButtons()[0].getSelected()===true){n="Y"}else if(t.getSelectedItems()[r].getCells()[1].getItems()[0].getButtons()[0].getSelected()===false){n="N"}else{n=""}if(g==="X"){if(t.getSelectedItems()[r].getCells()[7].getItems()[1].getText().indexOf("(")>-1){l=t.getSelectedItems()[r].getCells()[7].getItems()[1].getText().split("(")[0]}else{l=t.getSelectedItems()[r].getCells()[7].getItems()[1].getText()}}else{if(t.getSelectedItems()[r].getCells()[7].getItems()[0].getValue().indexOf("(")>-1){l=t.getSelectedItems()[r].getCells()[7].getItems()[0].getValue().split("(")[0]}else{l=t.getSelectedItems()[r].getCells()[7].getItems()[0].getValue()}}if(t.getSelectedItems()[r].getCells()[5].getValue().indexOf("(")>-1){s=t.getSelectedItems()[r].getCells()[5].getValue().split("(")[0]}else{s=t.getSelectedItems()[r].getCells()[5].getValue()}if(s===""){s="0.000"}if(t.getSelectedItems()[r].getCells()[6].getText().indexOf("(")>-1){a=t.getSelectedItems()[r].getCells()[6].getText().split("(")[0]}else{a=t.getSelectedItems()[r].getCells()[6].getText()}if(t.getSelectedItems()[r].getCells()[12].getText().indexOf("(")>-1){i=t.getSelectedItems()[r].getCells()[12].getText().split("(")[0]}else{i=t.getSelectedItems()[r].getCells()[12].getText()}var o=t.getSelectedItems()[r].getCells()[2].getSelected();e.push({Referenceid:d.getView().byId("textRefId").getText(),Inbounddelno:d.getView().byId("txtIndelivery").getText(),Shipmentno:d.getView().byId("txtShip").getText(),Item:t.getSelectedItems()[r].getCells()[10].getText(),Material:t.getSelectedItems()[r].getCells()[11].getText(),Description:t.getSelectedItems()[r].getCells()[0].getText(),Shipwt:l,Skidwt:s,Bandwt:a,Inventorywt:i,Batch:t.getSelectedItems()[r].getCells()[3].getText(),Quality:n,Quantity:t.getSelectedItems()[r].getCells()[4].getValue(),Storageloc:t.getSelectedItems()[r].getCells()[13].getValue(),Storagebin:t.getSelectedItems()[r].getCells()[8].getValue(),Mixstock:t.getSelectedItems()[r].getCells()[9].getSelectedItem().getProperty("text"),Moisturef:t.getSelectedItems()[r].getCells()[14].getSelectedItem().getProperty("text"),Fullrej:o?"Y":"N"})}return e},updateGoods:function(e,t,l,s){d.oBusy=new sap.m.BusyDialog;d.oBusy.open();e.IDelivery=d.getView().byId("txtIndelivery").getText();e.IReferenceid=d.getView().byId("textRefId").getText();e.IShipment=d.getView().byId("txtShip").getText();e.IUpdate="X";e.INavigation=d.flagNav;e.Referenceid=d.getView().byId("textRefId").getText();e.Inbounddelno=d.getView().byId("txtIndelivery").getText();e.Shipmentno=d.getView().byId("txtShip").getText();e.Plant=d.getView().byId("txtPlant").getCustomData()[0].getKey();e.Carrier=d.getView().byId("textCarrier").getText();e.Goodssupplier=d.GoodssupplierCode;var a=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});e.Receiptdt=a.format(new Date(d.recptdt))+"T00:00:00";if(d.getView().byId("rbYes").getSelected()===true){e.Paperwork="Y"}else if(d.getView().byId("rbNo").getSelected()===true){e.Paperwork="N"}else{e.Paperwork=""}e.Zuom=d.uom;if(d.getView().byId("inputDW").getValue().indexOf("(")>-1){e.Dunnagewt=d.getView().byId("inputDW").getValue().split("(")[0]}else{e.Dunnagewt=d.getView().byId("inputDW").getValue()}if(e.Dunnagewt===""){e.Dunnagewt="0.000"}if(d.getView().byId("inputNW").getText().indexOf("(")>-1){e.Netweight=d.getView().byId("inputNW").getText().split("(")[0]}else{e.Netweight=d.getView().byId("inputNW").getText()}if(e.Netweight===""){e.Netweight="0.000"}if(d.getView().byId("inputIW").getText().indexOf("(")>-1){e.Incomingwt=d.getView().byId("inputIW").getText().split("(")[0]}else{e.Incomingwt=d.getView().byId("inputIW").getText()}if(e.Incomingwt===""){e.Incomingwt="0.000"}if(d.getView().byId("inputOW").getText().indexOf("(")>-1){e.Outgoingwt=d.getView().byId("inputOW").getText().split("(")[0]}else{e.Outgoingwt=d.getView().byId("inputOW").getText()}if(e.Outgoingwt===""){e.Outgoingwt="0.000"}var i=d._getItemsData(t,s);e.NavMRDetail=i;var n=new sap.ui.model.odata.ODataModel(d.sServiceUrl);var r="/MRDetailSet";var o={success:jQuery.proxy(this.handleSubmitSuccessPerm,this),error:jQuery.proxy(this.handleSubmitFailure,this),async:true};n.create(r,e,o)},handleSubmitSuccessPerm:function(e,t){jQuery.sap.delayedCall(1500,d,function(){d.oBusy.close()});d.getView().byId("btnSave").setBusy(false);if(d.print==="X"){if(d.InfoMsg==="X"){l.show("Please create NCR for the items quality ‘N’",{icon:sap.m.MessageBox.Icon.SUCCESS,title:"Information",onClose:function(){d.onPrint()}})}else{d.onPrint()}d.print=""}else{var s=t.data.NavMRDetail.results[0].EMessage;sap.m.MessageBox.show(s,{icon:sap.m.MessageBox.Icon.SUCCESS,title:"Success",onClose:function(){if(d.InfoMsg==="X"){l.information("Please create NCR for the items quality ‘N��")}}})}},handleSubmitFailure:function(e){jQuery.sap.delayedCall(1500,d,function(){d.oBusy.close()});d.getView().byId("btnSave").setBusy(false);var t=$.parseXML(e.response.body);var s=t.querySelector("message");l.error(s.textContent)},onMoisture:function(e){var t=new sap.ui.model.odata.ODataModel(d.sServiceUrl);var s=d.getView().byId("idGoodReceiptTable");if(s.getSelectedItems().length>1){l.error("Please select only one item !")}else{var a=s.getSelectedItems()[0].getCells()[11].getProperty("text");var i=s.getSelectedItems()[0].getCells()[3].getProperty("text");var n=d.getView().byId("inputPlant").getValue();var r="/MoistureSet(IBatch='"+i+"',IMatnr='"+a+"',IPlant='"+n+"')";t.read(r,null,null,true,function(e){var t;if(e){if(e.ETcode===""){l.error("No Insp. Lot Exists !")}else{t=e.EHostname+"/sap/bc/gui/sap/its/webgui?~transaction=*"+e.ETcode+" QALS-PRUEFLOS= "+e.EPrueflos+";DYNP_OKCODE= =ENT0";sap.m.URLHelper.redirect(t,true)}}})}},onMoisture1:function(e,t){var l=e;d.clnt="D1ECLNT300";var s="";var a="";if(d.clnt){var i=d.clnt.split("CLNT");s=i[0];a=i[1]}var n="[System]"+"\r\n"+"Description="+t+"\r\n"+"Name="+s+"\r\n"+"Client="+a+"\r\n"+"[User]"+"\r\n"+"[Function]"+"\r\n"+"Command="+l+"\r\n"+"Title="+description+"\r\n"+"Type=Transaction"+"\r\n"+"[Configuration]"+"\r\n"+"[Options]"+"\r\n"+"Reuse=1"+"\r\n";var r=new Blob([n],{type:"application/x-sapshortcut;charset=utf-8"});saveAs(r,"launch.sap")},onNCR:function(e){var t=new sap.ui.model.odata.ODataModel(d.sServiceUrl);var s=d.getView().byId("idGoodReceiptTable");var a=s.getSelectedItems()[0].getCells()[1].getItems()[0].getButtons()[0].getSelected();if(s.getSelectedItems().length>1){l.error("Please select only one item !")}else{if(a===true){l.error("Please choose Quality ‘N’ to create NCR !");return}var i=s.getSelectedItems()[0].getCells()[3].getText();var n=d.getView().byId("txtIndelivery").getText();var r=s.getSelectedItems()[0].getCells()[10].getText();var o=s.getSelectedItems()[0].getCells()[11].getText();var g=d.getView().byId("inputPlant").getValue();var u=s.getSelectedItems()[0].getCells()[13].getValue();var c=d.getView().byId("textRefId").getText();d.oBusy=new sap.m.BusyDialog;d.oBusy.open();var m="/NCRSet(IBatch='"+i+"',IInbounddelivery='"+n+"',IItem='"+r+"',IMaterial='"+o+"',IPlant='"+g+"',IStoragelocation='"+u+"',IReferenceid='"+c+"')";t.read(m,null,null,true,function(e){jQuery.sap.delayedCall(1500,d,function(){d.oBusy.close()});var t;if(e){if(e.ETcode===""||e.ENotiftype===""||e.ENotification===""){l.error("Notification not created for the selected item")}else{t=e.EHostname+"/sap/bc/gui/sap/its/webgui?~transaction=*"+e.ETcode+" RIWO00-QMNUM="+e.ENotification+";DYNP_OKCODE= /00";sap.m.URLHelper.redirect(t,true)}}})}},onNCR1:function(e,t){var l=e;d.clnt="D1ECLNT300";var s="";var a="";if(d.clnt){var i=d.clnt.split("CLNT");s=i[0];a=i[1]}var n="[System]"+"\r\n"+"Description="+t+"\r\n"+"Name="+s+"\r\n"+"Client="+a+"\r\n"+"[User]"+"\r\n"+"[Function]"+"\r\n"+"Command="+l+"\r\n"+"Title=D1E"+"\r\n"+"Type=Transaction"+"\r\n"+"[Configuration]"+"\r\n"+"[Options]"+"\r\n"+"Reuse=1"+"\r\n";debugger;var r=new Blob([n],{type:"application/x-sapshortcut;charset=utf-8"});saveAs(r,"launch.sap")},enableSubmit:function(e){var t=sap.ui.getCore().byId("printer").getSelectedKey();var l=sap.ui.getCore().byId("nosLabels").getValue();var s=e.getSource().getParent().getParent().getParent().getParent().getParent();if(t===-1||l.length===0){s.getBeginButton().setEnabled(false)}else{s.getBeginButton().setEnabled(true)}},closePrintersDialog:function(){d.oPrinterDialog.destroy()},onPrintSave:function(e){d.print="X";d.onSave(e)},onPrint:function(){var e=this.getView().byId("inputPlant").getValue();if(d.IPrinterPlants.indexOf(e)===-1){d._onPrintSubmit()}else{d._loadPrinters();d.oPrinterDialog=sap.ui.xmlfragment("GoodReceipt.view.fragments.PrinterDialog",d)}},_loadPrinters:function(){sap.ui.core.BusyIndicator.show();var e=this.getView().byId("inputPlant").getValue();var l="/TprintersSet?$filter=IPlant eq '"+e+"'";var s=new sap.ui.model.odata.ODataModel(d.sServiceUrl);s.read(l,null,null,true,function(e){if(e){var l=new t(e.results);d.oPrinterDialog.setModel(l,"oPrinterModel");jQuery.sap.delayedCall(1500,d,function(){sap.ui.core.BusyIndicator.hide()});d.oPrinterDialog.open()}})},_onPrintSubmit:function(){var e=d.getView().byId("idGoodReceiptTable");var t=this.getView().byId("idGoodReceiptHeaderTable");var s=new sap.ui.model.odata.ODataModel(d.sServiceUrl,true);var a=[];var i=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var n=i.format(new Date(d.recptdt))+"T00:00:00";var r=this.getView().byId("inputPlant").getValue();var o,g;if(d.IPrinterPlants.indexOf(r)===-1){o="";g=1}else{o=sap.ui.getCore().byId("printer").getSelectedKey();g=parseInt(sap.ui.getCore().byId("nosLabels").getValue(),10)}for(var u=0;u<e.getSelectedItems().length;u++){var c={Lifex:d.getView().byId("textRefId").getText(),Matnr:e.getSelectedItems()[u].getCells()[11].getText(),Zbloc:e.getSelectedItems()[u].getCells()[8].getValue(),Charg:e.getSelectedItems()[u].getCells()[3].getText(),Zpieces:e.getSelectedItems()[u].getCells()[4].getValue(),Mixsf:e.getSelectedItems()[u].getCells()[9].getSelectedItem().getProperty("text"),Budat:n,Maktx:e.getSelectedItems()[u].getCells()[0].getText(),Lifnr:d.GoodssupplierCode,IPlant:r,IPrinter:o,ISheets:g,Znetgew:d.getView().byId("inputNW").getText(),Zuom:d.uom};a.push(s.createBatchOperation("BatchLabelSet","POST",c))}if(d.oPrinterDialog){d.closePrintersDialog()}s.addBatchChangeOperations(a);s.setUseBatch(true);s.submitBatch(function(e){if(e.__batchResponses[0].response){l.show(jQuery.parseJSON(e.__batchResponses[0].response.body).error.message.value,{icon:l.Icon.ERROR,title:"Error"})}else{l.show("Labels are printed successfully!!",{icon:l.Icon.SUCCESS,title:"Success"})}jQuery.sap.delayedCall(1500,d,function(){d.oBusy.close()})},function(e){l.error("Error!",{icon:l.Icon.ERROR,title:"Error!!"});jQuery.sap.delayedCall(1500,d,function(){d.oBusy.close()})})},_TableSettiing:function(){var e=new sap.ui.model.json.JSONModel({hasGrouping:false});this.getView().setModel(e,"Grouping");if(!this._oTPC){this._oTPC=new s({table:d.getView().byId("idGoodReceiptHeaderTable"),componentName:"GoodReceipt",persoService:a}).activate()}},_TableDetailSetting:function(){var e=new sap.ui.model.json.JSONModel({hasGrouping:false});this.getView().setModel(e,"Grouping");if(!this._oTPC1){this._oTPC1=new s({table:d.getView().byId("idGoodReceiptTable"),componentName:"GoodReceipt",persoService:a}).activate()}},dateTime:function(e){if(!e){return null}else{var t=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:d.datePattern.replace(/D/gi,"d")});return t.format(new Date(e))}},_setFooterDisable:function(){d.getView().byId("btnSave").setVisible(false);d.getView().byId("btnPrint").setVisible(false);d.getView().byId("btnNCR").setVisible(false);d.getView().byId("btnMoisture").setVisible(false)},_setFooterEnable:function(){d.getView().byId("btnSave").setVisible(true);d.getView().byId("btnPrint").setVisible(true);d.getView().byId("btnNCR").setVisible(true);d.getView().byId("btnMoisture").setVisible(true)},onPrintJsBtn:function(){var e=d.getView().getModel("headerModel");var t=d.getView().getModel("detailModel").getData();var l=e.getData().results[c];var s=new jsPDF("p","pt","a4");var a=[{title:"Material",dataKey:"mat"},{title:"Description",dataKey:"desc"},{title:"Batch#",dataKey:"batch"},{title:"Pieces",dataKey:"pieces"},{title:"Skid Weight",dataKey:"skidw"},{title:"Banding Weight",dataKey:"bandw"},{title:"Ship Weight",dataKey:"shipw"},{title:"Net Weight",dataKey:"netw"}];var i=[];var n=d.getView().byId("idGoodReceiptTable");for(var r=0;r<t.NavMRDetail.results.length;r++){i.push({mat:t.NavMRDetail.results[r].Material,desc:t.NavMRDetail.results[r].Description,batch:t.NavMRDetail.results[r].Batch,pieces:n.getSelectedItems()[r].getCells()[4].getValue(),skidw:t.NavMRDetail.results[r].Skidwt,bandw:t.NavMRDetail.results[r].Bandwt,shipw:t.NavMRDetail.results[r].Shipwt,netw:t.NavMRDetail.results[r].Inventorywt})}s.setFontSize(14);s.setFontType("bold");s.text(300,40,"Receipt Report","center");s.setFontSize(10);s.setFontType("normal");var o=80;s.text(40,o,"Reference ID : "+l.Referenceid);s.text(300,o,"Check In Date and Time : "+d.dateTimeConverter(l.Actualcidt,l.Actualcitime));s.text(40,o+20,"Truck Number : "+l.Trucknum);s.text(300,o+20,"Delivery Point : "+l.Receivingpt);s.text(40,o+40,"Trailer Number : "+l.Trailernum);s.text(300,o+40,"Incoming Weight : "+t.Incomingwt);s.text(40,o+60,"Inbound Delivery : "+t.IDelivery);s.text(300,o+60,"Outgoing Weight : "+t.Outgoingwt);s.text(40,o+80,"Carrier : "+t.Carrier);s.text(300,o+80,"Dunnage Weight : "+d.getView().byId("inputDW").getValue());s.text(40,o+100,"Goods Supplier : "+t.Goodssuppliername);s.text(300,o+100,"Net Weight : "+d.getView().byId("inputNW").getText());s.text(40,o+120,"Shipment Number : "+l.Shipmentno);s.text(300,o+120,"Status : "+l.Status);var g=o+120+30;s.setFontSize(12);s.setFontType("bold");s.text(40,g,"Materials");s.setFontType("normal");s.autoTable(a,i,{startY:g+10,margin:{horizontal:40},styles:{fontSize:8,overflow:"linebreak"},headerStyles:{halign:"center"},columnStyles:{mat:{columnWidth:65},desc:{columnWidth:65},batch:{columnWidth:55,halign:"center"},pieces:{columnWidth:55,halign:"center"},skidw:{columnWidth:55,halign:"center"},bandw:{columnWidth:55,halign:"center"},shipw:{columnWidth:55},netw:{columnWidth:55}}});if(sap.ui.Device.browser.name==="ie"){s.save("Receipt_Report.pdf")}else{window.open(s.output("bloburl"))}},dateTimeConverter:function(e,t){if(!t&&!e){return""}else{var l="";var s="";if(t){l=t.charAt(2)+t.charAt(3)+":"+t.charAt(5)+t.charAt(6)+":"+t.charAt(8)+t.charAt(9)}if(e){var a=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:d.datePattern.replace(/D/gi,"d")});s=a.format(new Date(e))}return s+" "+l}},handleCommentsOpenDialog:function(){d.oCommentsDialog=sap.ui.xmlfragment("GoodReceipt.view.fragments.CommentDialog",d);d._readComments()},_readComments:function(){var e=new sap.ui.model.odata.ODataModel(d.sServiceUrl);var s=d.getView().getModel("detailModel").getData().IShipment;var a="/LongtextSet?$filter=(ICico eq '' and ICreupd eq '' and IGr eq 'X' and IShipment eq '"+s+"')";e.read(a,null,null,true,function(e){if(e){var l=new t;if(e.results.length>0){e.results[0].OldTdline=e.results[0].Comment}else{e.results.push({Comment:"",OldTdline:""})}l.setData(e.results[0]);d.oCommentsDialog.setModel(l,"commentsModel");d.oCommentsDialog.open()}},function(e){var t=$.parseXML(e.response.body);var s=t.querySelector("message");l.error(s.textContent)})},onCommentSubmit:function(e){var t=sap.ui.getCore().byId("commentTextA").getValue();var l="";if(d.oCommentsDialog.getModel("commentsModel").getData()){l=d.oCommentsDialog.getModel("commentsModel").getData().OldTdline}d.oBusy=new sap.m.BusyDialog;d.oBusy.open();var s=new sap.ui.model.odata.ODataModel(d.sServiceUrl);var a="/LongtextSet";var i={success:jQuery.proxy(this.submitCommentsSuccessPerm,this),error:jQuery.proxy(this.submitCommentsFailure,this),async:true};var n={};n.ICico="";n.IGr="X";n.IReferenceid=d.getView().getModel("detailModel").getData().IReferenceid;n.IShipment=d.getView().getModel("detailModel").getData().IShipment;n.Comment=t;if(t!==l&&l===""){n.ICreupd="C";s.create(a,n,i)}else if(t!==l&&l!==""){n.ICreupd="U";s.create(a,n,i)}else{d.oCommentsDialog.destroy();d.oBusy.close()}},submitCommentsSuccessPerm:function(e,t){d.oCommentsDialog.destroy();jQuery.sap.delayedCall(1500,d,function(){d.oBusy.close()});sap.m.MessageBox.success("Comments saved successfully!")},submitCommentsFailure:function(e){d.oCommentsDialog.destroy();jQuery.sap.delayedCall(1500,d,function(){d.oBusy.close()});var t=$.parseXML(e.response.body);var s=t.querySelector("message");l.error(s.textContent)},closeCommentDialog:function(){d.oCommentsDialog.destroy()}})});