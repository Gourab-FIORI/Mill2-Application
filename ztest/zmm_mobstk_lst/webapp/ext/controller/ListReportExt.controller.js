sap.ui.define(["sap/m/ColumnListItem","sap/m/Label","sap/ui/model/Filter","sap/m/MessageToast","sap/m/MessageBox","sap/ui/comp/valuehelpdialog/ValueHelpDialog","sap/ui/model/json/JSONModel"],function(e,t,a,r,n,s,i){return sap.ui.controller("ZMM.zmm_mobstock_lst.ext.controller.ListReportExt",{onInit:function(){var e=this.getView();var t=sap.ui.core.Component.getOwnerIdFor(this.getView());var a=sap.ui.component(t).getComponentData();var r=false;if(a&&a.startupParameters&&a.startupParameters.EnableTransfers){r=a.startupParameters.EnableTransfers[0]}else{r=jQuery.sap.getUriParameters().get("EnableTransfers")}this._oTransfersModel=this._initFrontEndModel(e);if(!this._oTransferDialog){this._oTransferDialog=sap.ui.xmlfragment({fragmentName:"ZMM.zmm_mobstock_lst.ext.fragment.TransferDialog",type:"XML",id:"ZMM.zmm_mobstock_lst.ext.TransferDialog"},this);this._oTransferDialog.setModel(e.getModel());e.addDependent(this._oTransferDialog)}},_initFrontEndModel:function(e){var t=new sap.ui.model.json.JSONModel({NewTransfer:this._getEmptyTransfer()});e.setModel(t,"Transfers");return t},_getEmptyTransfer:function(){return{TransferType:"",Material:"",Plant:"",StorageLocation:"",Batch:"",BatchManaged:"",SupplierBatch:"",SpecialStock:"",StockType:"",StockTypeText:"",AvailableQuantity:"",AvailableQuantityUnit:"",Quantity:"",Unit:"",WMLBin:"",SalesOrder:"",SalesOrderItem:"",Vendor:"",DstStorageLocation:"",DstStorageLocationEditable:true,DstWMLBin:"",DstSalesOrderVisible:false,DstSalesOrder:"",DstSalesOrderItem:"",DstVendor:"",ValidTransfer:false,TransferTypeState:sap.ui.core.ValueState.Error,TransferTypeStateText:null,QuantityState:sap.ui.core.ValueState.Error,QuantityStateText:null,DstStorageLocationState:null,DstStorageLocationStateText:null,DstSalesOrderState:null,DstSalesOrderStateText:null,DstVendorState:null,DstVendorStateText:null,WMLBinVisible:false,DstWMLBinVisible:false,DstStorageBinState:null,DstStorageBinStateText:null,StorageBinState:null,StorageBinStateText:null,StorageLocationWMLEnabled:false}},_initNewTransfer:function(e,t){var a=e.getObject("/NewTransfer");var r=0;if(t){r=parseFloat(t.Quantity);if(isNaN(r)){r=0}}var n=sap.ui.core.format.NumberFormat.getFloatInstance().format(r);a.TransferType="";a.Material=t?t.Material:"";a.Plant=t?t.Plant:"";a.StorageLocation=t?t.StorageLocation:"";a.Batch=t?t.Batch:"";a.BatchManaged=t?t.BatchManaged:false;a.SupplierBatch=t?t.BatchBySupplier:"";a.StockType=t?t.InventoryStockType:"";a.StockTypeText=t?t.InventoryStockTypeText:"";a.SpecialStock=t?t.InventorySpecialStockType:"";a.AvailableQuantity=sap.ui.core.format.NumberFormat.getFloatInstance().parse(n);a.AvailableQuantityUnit=t?t.Unit:"";a.Quantity=n;a.Unit=t?t.Unit:"";a.WMLBin=this._getStockEntryWMLBin(t);a.SalesOrder=this._getStockEntrySalesOrder(t);a.SalesOrderItem=this._getStockEntrySalesOrderItem(t);a.Vendor=this._getStockEntryVendor(t);a.DstStorageLocation="";a.DstStorageLocationEditable=true;a.DstWMLBin="";a.DstSalesOrder="";a.DstSalesOrderItem="";a.DstVendor="";a.ValidTransfer=false;a.TransferTypeState=sap.ui.core.ValueState.Error;a.TransferTypeStateText="";a.QuantityState=sap.ui.core.ValueState.Information;a.QuantityStateText="Quantity is maximum.";a.DstStorageLocationState=null;a.DstSalesOrderVisible=false;a.DstVendorVisible=false;a.DstSalesOrderState=null;a.DstSalesOrderStateText=null;a.DstVendorState=null;a.DstVendorStateText=null;a.WMLBinVisible=false;a.DstWMLBinVisible=false;a.StorageLocationWMLEnabled=t?t.StorageLocationWMLEnabled==="X":false;e.updateBindings(true);return a},_getStockEntrySalesOrder:function(e){if(e){if(e.InventorySpecialStockType!=="E"){return""}var t=e.StockSegment.split("/");if(t.length===0){return""}return t[0].trim()}return""},_getStockEntrySalesOrderItem:function(e){if(e){if(e.InventorySpecialStockType!=="E"){return""}var t=e.StockSegment.split("/");if(t.length===0){return""}return t[1].trim()}return""},_getStockEntryVendor:function(e){if(e){if(e.InventorySpecialStockType!=="K"){return""}return e.StockSegment}return""},_getStockEntryWMLBin:function(e){if(e&&e.DefaultWMLBin){return e.DefaultWMLBin}return""},onStorageLocationValueHelpRequest:function(e){var t=this.getView().getModel("Transfers");var r=t.getObject("/NewTransfer");var n="Desired Value";var o=new s({supportRangesOnly:false,supportMultiselect:false,title:n,supportRanges:false,key:"StorageLocation",keys:["Plant"],descriptionKey:"StorageLocationName",ok:jQuery.proxy(this._oStorageLocationValueHelpResultSelect,this),cancel:function(){this.close()},afterClose:function(){this.setModel(null)},beforeOpen:function(){this.oSelectionTitle.setText(n)}});var l=[];l.push({label:"Storage Location",tooltip:"Storage Location",template:"StorageLocation",type:"string"});l.push({label:"Storage Location Name",tooltip:"Storage Location Name",template:"StorageLocationName",type:"string"});o.setModel(this.getView().getModel());o.setModel(new i({cols:l}),"columns");var u=[new a("Plant","EQ",r.Plant)];o.setTokens([]);o.getTableAsync().then(function(e){e.setBusy(true);if(e.bindRows){e.bindAggregation("rows",{path:"/ZC_STLOC_WWML",filters:u,sorter:new sap.ui.model.Sorter("StorageLocation"),events:{dataReceived:jQuery.proxy(function(t){e.setBusy(false);var a=t.getSource(),r;if(a&&this&&this.isOpen()){r=a.getLength();if(r){this.update()}}},o)}})}if(e.bindItems){var t=new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{StorageLocation}"}),new sap.m.Text({text:"{StorageLocationName}"})]});e.bindAggregation("items",{path:"/ZC_STLOC_WWML",filters:u,sorter:new sap.ui.model.Sorter("StorageLocation"),events:{dataReceived:jQuery.proxy(function(t){e.setBusy(false);var a=t.getSource(),r;if(a&&this&&this.isOpen()){r=a.getLength();if(r){this.update()}}},o)},template:t,templateShareable:false})}});o.open()},_oStorageLocationValueHelpResultSelect:function(e){var t=e.getSource();var a=this.getView().getModel("Transfers");var r=a.getObject("/NewTransfer");t.getTableAsync().then(function(e){var n;if(e.getSelectedIndex){n=e.getContextByIndex(e.getSelectedIndex())}if(!n&&e.getSelectedContexts){n=e.getSelectedContexts().find(()=>true)}if(!n){t.close();return}var s=n.getObject();r.DstStorageLocation=s.StorageLocation?s.StorageLocation:"";r.DstWMLBinVisible=s.WMLEnabled&&s.WMLEnabled==="X"?true:false;r.DstWMLBin="";this._validateNewTransfer(a);a.updateBindings(true);t.close()}.bind(this))},onUoMValueHelpRequest:function(e){var t=this.getView().getModel("Transfers");var r=t.getObject("/NewTransfer");var n="Desired Value";var o=new s({supportRangesOnly:false,supportMultiselect:false,title:n,supportRanges:false,key:"UnitOfMeasure",keys:["Material"],descriptionKey:"UnitOfMeasureName",ok:jQuery.proxy(this._oUoMValueHelpResultSelect,this),cancel:function(){this.close()},afterClose:function(){this.setModel(null)},beforeOpen:function(){this.oSelectionTitle.setText(n)}});var l=[];l.push({label:"Unit Of Measure",tooltip:"Unit Of Measure",template:"UnitOfMeasure",type:"string"});l.push({label:"Unit Of Measure Name",tooltip:"Unit Of Measure Name",template:"UnitOfMeasureName",type:"string"});o.setModel(this.getView().getModel());o.setModel(new i({cols:l}),"columns");var u=[new a("Material","EQ",r.Material),new a("UnitOfMeasure","NE",r.Unit)];o.setTokens([]);o.getTableAsync().then(function(e){e.setBusy(true);if(e.bindRows){e.bindAggregation("rows",{path:"/ZC_MATUOM_VH",filters:u,sorter:new sap.ui.model.Sorter("UnitOfMeasure"),events:{dataReceived:jQuery.proxy(function(t){e.setBusy(false);var a=t.getSource(),r;if(a&&this&&this.isOpen()){r=a.getLength();if(r){this.update()}}},o)}})}if(e.bindItems){var t=new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{UnitOfMeasure}"}),new sap.m.Text({text:"{UnitOfMeasureName}"})]});e.bindAggregation("items",{path:"/ZC_MATUOM_VH",filters:u,sorter:new sap.ui.model.Sorter("UnitOfMeasure"),events:{dataReceived:jQuery.proxy(function(t){e.setBusy(false);var a=t.getSource(),r;if(a&&this&&this.isOpen()){r=a.getLength();if(r){this.update()}}},o)},template:t,templateShareable:false})}});o.open()},onWmlBinValueHelpRequest:function(e){var t=this.getView().getModel("Transfers");var r=t.getObject("/NewTransfer");var n=e.getSource().getBinding("value");var o=n.getPath();var l="Desired Value";var u=new s({supportRangesOnly:false,supportMultiselect:false,title:l,supportRanges:false,key:"StorageBin",keys:["Plant","StorageLocation"],descriptionKey:"StorageLocation",ok:jQuery.proxy(this._oWmlBinValueHelpResultSelect,this),cancel:function(){this.close()},afterClose:function(){this.setModel(null)},beforeOpen:function(){this.oSelectionTitle.setText(l)}});u.data("sInputPath",o);var c=[];c.push({label:"Bin",tooltip:"Bin",template:"StorageBin",type:"string"});c.push({label:"Batch",tooltip:"Batch",template:"Batch",type:"string"});c.push({label:"Quantity",tooltip:"Quantity",template:"AlternativeUnitQuantity",type:"number"});c.push({label:"Unit of Measure",tooltip:"Unit of Measure",template:"AlternativeUnit",type:"string"});u.setModel(this.getView().getModel());var f=[new a("Material","EQ",r.Material),new a("Plant","EQ",r.Plant),new a("AlternativeUnit","EQ",r.Unit)];if(r.Batch!==""){f.push(new a("Batch","EQ",r.Batch))}if(r.StorageLocation!==""){f.push(new a("StorageLocation","EQ",r.StorageLocation))}if(r.TransferType==="343"){f.push(new a("StockType","EQ","07"))}if(r.TransferType==="344"){f.push(new a("StockType","EQ","01"))}if(r.TransferType==="311"){f.push(new a("StockType","EQ",r.StockType))}if(r.SpecialStock==="E"){f.push(new a("SalesOrder","EQ",r.SalesOrder));f.push(new a("SalesOrderItem","EQ",r.SalesOrderItem))}else{f.push(new a("SalesOrder","EQ",""))}u.setTokens([]);u.getTableAsync().then(function(e){e.setBusy(true);e.setModel(new i({cols:c}),"columns");if(e.bindRows){e.removeColumn(2);e.insertColumn(new sap.ui.table.Column({label:new sap.m.Label({text:"Quantity"}),template:new sap.m.Text({text:"{ path:'AlternativeUnitQuantity', type:'sap.ui.model.type.Float', formatOptions : {maxFractionDigits:3, minFractionDigits:3, maxIntegerDigits:10, minIntegerDigits:1} }"})}),2);e.bindAggregation("rows",{path:"/ZC_WMLNZSTKAU",filters:f,sorter:new sap.ui.model.Sorter("StorageBin"),events:{dataReceived:jQuery.proxy(function(t){e.setBusy(false);var a=t.getSource(),r;if(a&&this&&this.isOpen()){r=a.getLength();if(r){this.update()}}},u)}})}if(e.bindItems){var t=new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{StorageBin}"}),new sap.m.Text({text:"{Batch}"}),new sap.m.Text({text:"{path:'AlternativeUnitQuantity', type:'sap.ui.model.type.Float', formatOptions : { maxFractionDigits:3, minFractionDigits:3, maxIntegerDigits:10, minIntegerDigits:1, groupingEnabled:true}}"}),new sap.m.Text({text:"{AlternativeUnit}"})]});e.bindAggregation("items",{path:"/ZC_WMLNZSTKAU",filters:f,sorter:new sap.ui.model.Sorter("StorageBin"),events:{dataReceived:jQuery.proxy(function(t){e.setBusy(false);var a=t.getSource(),r;if(a&&this&&this.isOpen()){r=a.getLength();if(r){this.update()}}},u)},template:t,templateShareable:false})}});u.open()},onDstWmlBinValueHelpRequest:function(e){var t=this.getView().getModel("Transfers");var r=t.getObject("/NewTransfer");var n=e.getSource().getBinding("value");var o=n.getPath();var l="Desired Value";var u=new s({supportRangesOnly:false,supportMultiselect:false,title:l,supportRanges:false,key:"StorageBin",keys:["Plant","StorageLocation"],descriptionKey:"StorageLocation",ok:jQuery.proxy(this._oWmlBinValueHelpResultSelect,this),cancel:function(){this.close()},afterClose:function(){this.setModel(null)},beforeOpen:function(){this.oSelectionTitle.setText(l)}});u.data("sInputPath",o);var c=[];c.push({label:"Bin",tooltip:"Bin",template:"StorageBin",type:"string"});c.push({label:"Storage Location",tooltip:"Storage Location",template:"StorageLocation",type:"string"});c.push({label:"Storage Location Name",tooltip:"Storage Location Name",template:"StorageLocationName",type:"string"});u.setModel(this.getView().getModel());u.setModel(new i({cols:c}),"columns");var f=[new a("Plant","EQ",r.Plant)];if(r.DstStorageLocation!==""){f.push(new a("StorageLocation","EQ",r.DstStorageLocation))}if(o==="/NewTransfer/DstWMLBin"){if(r.WMLBin!==""){f.push(new a("StorageBin","NE",r.WMLBin))}}u.setTokens([]);var S=new sap.ui.comp.filterbar.FilterBar({advancedMode:true,filterBarExpanded:false,showGoOnFB:!sap.ui.Device.system.phone,filterGroupItems:[new sap.ui.comp.filterbar.FilterGroupItem({groupTitle:"Bin",groupName:"Bin",name:"Bin",label:"Bin",control:new sap.m.Input})],search:function(e){var t=e.getSource();var r=t.getBasicSearchValue();u.getTableAsync().then(function(e){e.setBusy(true);var t=e.getBinding("items");if(t){t.filter([new a("StorageBin",sap.ui.model.FilterOperator.Contains,r)])}else{t=e.getBinding("rows");if(t){t.filter([new a("StorageBin",sap.ui.model.FilterOperator.Contains,r)])}}e.setBusy(false)})}});if(S.setBasicSearch){S.setBasicSearch(new sap.m.SearchField({showSearchButton:sap.ui.Device.system.phone,placeholder:"Search",search:function(e){u.getFilterBar().search()}}))}u.setFilterBar(S);u.getTableAsync().then(function(e){e.setBusy(true);if(e.bindRows){e.bindAggregation("rows",{path:"/ZC_WMLBIN_VH",filters:f,sorter:new sap.ui.model.Sorter("StorageBin"),events:{dataReceived:jQuery.proxy(function(t){e.setBusy(false);var a=t.getSource(),r;if(a&&this&&this.isOpen()){r=a.getLength();if(r){this.update()}}},u)}})}if(e.bindItems){var t=new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{StorageBin}"}),new sap.m.Text({text:"{Batch}"})]});e.bindAggregation("items",{path:"/ZC_WMLBIN_VH",filters:f,sorter:new sap.ui.model.Sorter("StorageBin"),events:{dataReceived:jQuery.proxy(function(t){e.setBusy(false);var a=t.getSource(),r;if(a&&this&&this.isOpen()){r=a.getLength();if(r){this.update()}}},u)},template:t,templateShareable:false})}});u.open()},_oWmlBinValueHelpResultSelect:function(e){var t=e.getParameter("tokens");if(t){var a=t.find(()=>true);if(a&&a.getProperty("key")){var r=e.getSource();var n=r.data();var s=a.getProperty("key");if(n.sInputPath&&s!==""){var i=n.sInputPath;var o=this.getView().getModel("Transfers");var l=o.getObject("/NewTransfer");r.getTableAsync().then(function(e){var t;if(e.getSelectedIndex){t=e.getContextByIndex(e.getSelectedIndex())}if(!t&&e.getSelectedContexts){t=e.getSelectedContexts().find(()=>true)}if(!t){r.close();return}var a=t.getObject();if(a){if(i==="/NewTransfer/WMLBin"){l.WMLBin=s;var n=parseFloat(a.AlternativeUnitQuantity);if(isNaN(n)){n=0}l.Quantity=sap.ui.core.format.NumberFormat.getFloatInstance().format(n)}else if(i==="/NewTransfer/DstWMLBin"){l.DstWMLBin=s;l.DstStorageLocation=a.StorageLocation}this._validateNewTransfer(o);o.updateBindings(true)}r.close()}.bind(this))}}}},_oUoMValueHelpResultSelect:function(e){var t=e.getParameter("tokens");if(t){var a=t.find(()=>true);if(a&&a.getProperty("key")){var r=e.getSource();var n=this.getView().getModel();var s=this.getView().getModel("Transfers");var i=s.getObject("/NewTransfer");i.Unit=a.getProperty("key");r.setBusy(true);this._onNewTransferUoMChange(n,s,r)}}},handleUoMChange:function(e){var t=this.getView().getModel();var a=this.getView().getModel("Transfers");this._onNewTransferUoMChange(t,a);this._validateNewTransfer(a)},_onNewTransferUoMChange:function(e,t,r){var n=t.getObject("/NewTransfer");var s=n.Material;var i=n.Unit;var o=n.AvailableQuantityUnit;var l=[new a("Material","EQ",s)];var u=sap.ui.core.format.NumberFormat.getFloatInstance();e.read("/ZC_MATUOM_VH",{method:"GET",filters:l,success:function(e){var a=e.results;if(a!==undefined&&a.length>0){var s=a.find(e=>e.UnitOfMeasure&&e.UnitOfMeasure===i);var l=a.find(e=>e.UnitOfMeasure&&e.UnitOfMeasure===o);if(s&&l&&s.UnitOfMeasure!==l.UnitOfMeasure){var c=u.parse(l.QuantityNumerator);var f=u.parse(l.QuantityDenominator);var S=u.parse(s.QuantityNumerator);var g=u.parse(s.QuantityDenominator);var p=c*g;var d=f*S;var h=p/d;if(n.Quantity!==""){var T=u.parse(n.Quantity);T*=h}var m=parseFloat(n.AvailableQuantity);m*=h;n.Quantity=u.format(T);n.AvailableQuantity=m;n.AvailableQuantityUnit=s.UnitOfMeasure;t.updateBindings(true);if(r){r.setBusy(false);r.close()}return}}n.Quantity=0;t.updateBindings(true);if(r){r.setBusy(false);r.close()}},error:function(){n.Quantity=0;t.updateBindings(true);if(r){r.setBusy(false);r.close()}}})},handleDstStorageLocationChange:function(e){var t=this.getView().getModel();var r=this.getView().getModel("Transfers");var n=r.getObject("/NewTransfer");var s=n.Plant;var i=n.DstStorageLocation;var o=[new a("Plant","EQ",s),new a("StorageLocation","EQ",i)];t.read("/ZC_STLOC_WWML",{method:"GET",filters:o,success:function(t){var a=t.results;if(!a.length||a.length===0){n.DstStorageLocationState=sap.ui.core.ValueState.Error;n.DstStorageLocationStateText="Storage location '"+i+"' not found.";n.DstStorageLocation="";n.DstWMLBinVisible=false;n.DstWMLBin="";this._validateNewTransfer(this._oTransfersModel,e.getSource());r.updateBindings(true);return}var s=a[0];n.DstStorageLocationState=null;n.DstStorageLocationStateText=null;n.DstStorageLocation=s.StorageLocation?s.StorageLocation:"";n.DstWMLBinVisible=s.WMLEnabled&&s.WMLEnabled==="X"?true:false;n.DstWMLBin="";this._validateNewTransfer(r);r.updateBindings(true)}.bind(this),error:function(){n.DstStorageLocationState=sap.ui.core.ValueState.Error;n.DstStorageLocationStateText="Storage location '"+i+"' not found due to error.";n.DstStorageLocation="";n.DstWMLBinVisible=false;n.DstWMLBin="";this._validateNewTransfer(r);r.updateBindings(true)}.bind(this)})},_validateNewTransfer:function(e,t){var a=e.getObject("/NewTransfer");var r=true;var n=sap.ui.core.format.NumberFormat.getFloatInstance({groupingEnabled:true,groupingSize:3,decimals:3});if(a.TransferType===""){a.TransferTypeState=sap.ui.core.ValueState.Error;a.TransferTypeStateText=null;r=false}else{if(a.TransferType==="414"&&(a.SalesOrder===""||a.SalesOrderItem==="")){a.TransferTypeState=sap.ui.core.ValueState.Error;a.TransferTypeStateText="Only available for entries with Sales Order.";r=false}else if(a.TransferType==="343"&&a.StockType!=="07"){a.TransferTypeState=sap.ui.core.ValueState.Error;a.TransferTypeStateText="Only available for blocked stock.";r=false}else if(a.TransferType==="344"&&a.StockType!=="01"){a.TransferTypeState=sap.ui.core.ValueState.Error;a.TransferTypeStateText="Only available for unrestricted stock.";r=false}else{a.TransferTypeState=null;a.TransferTypeStateText=null}}if(a.DstStorageLocation===""){a.DstStorageLocationState=sap.ui.core.ValueState.Error;a.DstStorageLocationStateText="Storage location cannot be empty.";r=false}else{a.DstStorageLocationState=null;a.DstStorageLocationStateText=null}if(a.DstSalesOrderVisible===true){if(a.DstSalesOrder!==""&&a.DstSalesOrderItem!==""&&(a.DstSalesOrder!==a.SalesOrder||a.DstSalesOrderItem!==a.SalesOrderItem)){a.DstSalesOrderState=null;a.DstSalesOrderStateText=null}else{a.DstSalesOrderState=sap.ui.core.ValueState.Error;a.DstSalesOrderStateText=null;r=false}}if(a.DstVendorVisible===true){if(!a.DstVendor){a.DstVendorState=sap.ui.core.ValueState.Error;a.DstVendorStateText=null;r=false}else{a.DstVendorState=null;a.DstVendorStateText=null}}if(a.Quantity===""){a.QuantityState=sap.ui.core.ValueState.Error;a.QuantityStateText=null;r=false}else{var s=a.AvailableQuantity;var i=a.Quantity;if(i>s){a.QuantityState=sap.ui.core.ValueState.Error;a.QuantityStateText="Greater than available quantity.";r=false}else if(i===s){a.QuantityState=sap.ui.core.ValueState.Information;a.QuantityStateText="Quantity is maximum."}else{a.QuantityState=null;a.QuantityStateText=null}}if(a.WMLBinVisible&&a.WMLBin===""){a.StorageBinState=sap.ui.core.ValueState.Error;a.StorageBinStateText="Storage Bin cannot be empty.";r=false}else{a.StorageBinState=null;a.StorageBinStateText=null}if(a.DstWMLBinVisible&&a.DstWMLBin===""){a.DstStorageBinState=sap.ui.core.ValueState.Error;a.DstStorageBinStateText="Storage Bin cannot be empty.";r=false}else{a.DstStorageBinState=null;a.DstStorageBinStateText=null}a.ValidTransfer=r;return r},handleScanSuccess:function(e){if(e.getParameter("cancelled")){r.show("Scan cancelled",{duration:1e3})}else{var t=this.byId("listReportFilter-btnBasicSearch");var a=this.byId("listReportFilter-btnGo");if(e.getParameter("text")){t.setValue(e.getParameter("text"));a.firePress()}else{t.setValue("")}}},handleScanError:function(e){r.show("Scan failed: "+e,{duration:1e3})},handleScanLiveupdate:function(e){},handleTransferCellButton:function(e){var t=e.getSource().getBindingContext();var a=t.getObject();this._initNewTransfer(this._oTransfersModel,a);var r=this._oTransferDialog;r.bindElement({path:t.getPath(),events:{change:function(e){},dataRequested:function(){r.setBusy(true)},dataReceived:function(e){r.setBusy(false)}}});r.open()},handleTransferDialogOk:function(e){var t=e.getSource().getParent();var a=t.getParent().getModel();var r=this._oTransfersModel.getObject("/NewTransfer");if(r.ValidTransfer===true){this._doTransfer(a,r)}},handleTransferDialogCancel:function(e){var t=e.getSource().getParent();this._initNewTransfer(this._oTransfersModel);t.close()},handleTransferTypeChange:function(e){var t=e.getSource().getSelectedKey();var r=e.getSource().getBindingContext();var n=this.getView().getModel();var s=this.getView().getModel("Transfers");var i=s.getObject("/NewTransfer");var o=r.getObject();i.TransferType=t;i.DstStorageLocationEditable=true;i.DstStorageLocation="";i.DstSalesOrderVisible=false;i.DstVendorVisible=false;i.DstSalesOrderState=null;i.DstSalesOrderStateText=null;i.DstVendorState=null;i.DstVendorStateText=null;i.WMLBinVisible=i.StorageLocationWMLEnabled;i.DstWMLBinVisible=false;if(i.WMLBinVisible){var l=[new a("Material","EQ",i.Material),new a("Plant","EQ",i.Plant),new a("AlternativeUnit","EQ",i.Unit)];l.push(new a("Batch","EQ",i.Batch));l.push(new a("StorageLocation","EQ",i.StorageLocation));l.push(new a("StockType","EQ",i.StockType));if(i.SpecialStock==="E"){l.push(new a("SalesOrder","EQ",i.SalesOrder));l.push(new a("SalesOrderItem","EQ",i.SalesOrderItem))}else{l.push(new a("SalesOrder","EQ",""))}n.read("/ZC_WMLNZSTKAU",{method:"GET",filters:l,success:function(t){var a=t.results;if(a!==undefined&&a.length>0){var r=a[0];i.WMLBin=r.StorageBin;var n=parseFloat(r.AlternativeUnitQuantity);if(isNaN(n)){n=0}i.Quantity=sap.ui.core.format.NumberFormat.getFloatInstance().format(n);this._validateNewTransfer(this._oTransfersModel,e.getSource());s.updateBindings(true);return}}.bind(this),error:function(){}})}if(i.TransferType==="311"){i.DstStorageLocation=o.StorageLocation;i.DstWMLBinVisible=i.StorageLocationWMLEnabled}if(i.TransferType==="343"||i.TransferType==="344"){i.WMLBinVisible=i.StorageLocationWMLEnabled;i.DstWMLBinVisible=false}if(i.TransferType==="413"){i.DstStorageLocation=o.StorageLocation;i.DstStorageLocationEditable=false;i.DstSalesOrder=this._getStockEntrySalesOrder(o);i.DstSalesOrderItem=this._getStockEntrySalesOrderItem(o);i.DstSalesOrderVisible=true;i.DstSalesOrderState=sap.ui.core.ValueState.Error;i.DstSalesOrderStateText=null}if(i.TransferType==="343"||i.TransferType==="344"||i.TransferType==="413"||i.TransferType==="414"){i.DstStorageLocation=o.StorageLocation;i.DstStorageLocationEditable=false}this._validateNewTransfer(this._oTransfersModel,e.getSource());this._oTransfersModel.updateBindings(true)},handleQuantityChange:function(e){var t=e.getParameter("value");var a=this._oTransfersModel.getObject("/NewTransfer");var r=sap.ui.core.format.NumberFormat.getFloatInstance().parse(t);a.Quantity=sap.ui.core.format.NumberFormat.getFloatInstance().format(r);this._validateNewTransfer(this._oTransfersModel,e.getSource());this._oTransfersModel.updateBindings(true)},handleUOMChange:function(e){var t=e.getParameter("value");var a=this._oTransfersModel.getObject("/NewTransfer");a.Unit=t},handleDstSalesOrderChange:function(e){var t=e.getParameter("value");var a=this._oTransfersModel.getObject("/NewTransfer");var r=parseInt(t,10);if(!isNaN(r)){a.DstSalesOrder=String(r)}else{a.DstSalesOrder=""}this._validateNewTransfer(this._oTransfersModel,e.getSource());this._oTransfersModel.updateBindings(true)},handleDstSalesOrderItemChange:function(e){var t=e.getParameter("value");var a=this._oTransfersModel.getObject("/NewTransfer");var r=parseInt(t,10);if(!isNaN(r)){a.DstSalesOrderItem=String(r)}else{a.DstSalesOrderItem=""}this._validateNewTransfer(this._oTransfersModel,e.getSource());this._oTransfersModel.updateBindings(true)},handleDstVendorChange:function(e){this._validateNewTransfer(this._oTransfersModel,e.getSource());this._oTransfersModel.updateBindings(true)},handleDstWmlBinChange:function(e){var t=e.getParameter("value");var r=this.getView().getModel();var n=this.getView().getModel("Transfers");var s=n.getObject("/NewTransfer");var i=s.Plant;var o=s.DstStorageLocation;var l=[new a("StorageBin","EQ",t),new a("StorageLocation","EQ",o),new a("Plant","EQ",i)];r.read("/ZC_WMLBIN_VH",{method:"GET",filters:l,success:function(e){var a=e.results;if(!a.length||a.length===0){s.DstStorageBinState=sap.ui.core.ValueState.Error;s.DstStorageBinStateText=this._i18nText("MSG_STORAGEBIN_NOT_FOUND",t);s.DstWMLBin="";s.ValidTransfer=false;n.updateBindings(true);return}var r=a[0];s.DstWMLBin=r.StorageBin;s.DstStorageBinState=null;s.DstStorageBinStateText="";s.DstStorageLocation=r.StorageLocation;s.DstStorageLocationState=null;s.DstStorageLocationStateText=null;this._validateNewTransfer(n);n.updateBindings(true)}.bind(this),error:function(){s.DstStorageBinState=sap.ui.core.ValueState.Error;s.DstStorageBinStateText=this._i18nText("MSG_STORAGEBIN_NOT_FOUND",t);s.DstWMLBin="";s.ValidTransfer=false;n.updateBindings(true)}.bind(this)})},_doTransfer:function(e,t){var a=sap.ui.core.format.NumberFormat.getFloatInstance().parse(t.Quantity);var r={method:"POST",urlParameters:{TransferType:t.TransferType,Material:t.Material,Plant:t.Plant,StorageLocation:t.StorageLocation,Batch:t.Batch,SupplierBatch:t.SupplierBatch?t.SupplierBatch:"",StockType:t.StockType?t.StockType:"",SpecialStock:t.SpecialStock?t.SpecialStock:"",SalesOrder:t.SalesOrder?t.SalesOrder:"",SalesOrderItem:t.SalesOrderItem?t.SalesOrderItem:"",Vendor:!t.Vendor?"":t.Vendor,WMLBin:t.WMLBin?t.WMLBin:"",Quantity:a,UnitOfMeasure:t.Unit,DstBatch:"",DstStorageLocation:t.DstStorageLocation,DstSalesOrder:t.DstSalesOrder?t.DstSalesOrder:"",DstSalesOrderItem:t.DstSalesOrder?t.DstSalesOrderItem:"",DstVendor:!t.DstVendor?"":t.DstVendor,DstWMLBin:t.DstWMLBin?t.DstWMLBin:""},context:null,success:jQuery.proxy(this._handleTransferStockSuccess,this),error:jQuery.proxy(this._handleTransferStockError,this),async:true};e.callFunction("/TransferStock",r)},_handleTransferStockSuccess:function(e,t,a){if(!a){a=this}if(e.TransferStock){r.show("Transfer completed ok with "+e.TransferStock.MaterialDocument+"/"+e.TransferStock.DocumentYear)}a._initNewTransfer(a.getView().getModel("Transfers"));a.getView().getModel("Transfers").updateBindings(true);a.getView().getModel().refresh(true);a._oTransferDialog.close()},_handleTransferStockError:function(e,t){if(!t){t=this}t._showTransferStockErrorMsgBox(e,t)},_showTransferStockErrorMsgBox:function(e){var t=null;if(e.response){try{t=jQuery.sap.parseJS(e.response.body)}catch(e){return false}}if(e.responseText){try{t=jQuery.sap.parseJS(e.responseText)}catch(e){return false}}if(t&&t.error&&t.error.code){n.show(t.error.message.value,{icon:n.Icon.ERROR,title:"Transfer stock error",actions:[n.Action.OK],emphasizedAction:n.Action.OK,onClose:function(e){}})}return true},_i18nText:function(e){if(!this.getView()){return e}var t=this.getView().getModel("i18n");if(arguments.length>1){var a=t.getProperty(arguments[0]);if(a){for(var r=1;r<arguments.length;++r){a=a.replace("{"+r+"}",arguments[r])}}return a}else{return t.getProperty(e)}}})});